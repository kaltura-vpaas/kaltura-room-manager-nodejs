extends layout

block content
  img.heroimg#heroimg(src="/images/kaltura-logo.png" alt="Kaltura Logo")
  h1= title
  h4.divider _______________

  table.table.table-striped#roomTable(style="width:100%;table-layout:fixed;")
    thead
      tr
        th(style='width:5%') Update
        th(style='width:10%') Resource ID
        th(style='width:20%') Room Name
        th(style='width:20%') Description
        th(style='width:45%') Tags
    tbody
      each room in resources
        tr
          td
            input(type="checkbox",id=room.id)
          td= room.id
          td(contenteditable)= room.name
          td(contenteditable)= room.description
          td(contenteditable)= room.tags

  script.
    var updaterooms = function() {
      var checkedRows = [];
      var headersText = [];
      var $headers = $("th");
      var keys = ["", "id", "name", "description", "tags"];

      // Loop through the rows and add the checked ones to checkedRows
      var rowNumber = 0;
      var $rows = $("tbody tr").each(function(index) {
        $cells = $(this).find("td");
        //console.log("row " + index + " checked: " + document.getElementById($cells[1].innerText).checked);

        // Add row if checkbox is checked
        if (document.getElementById($cells[1].innerText).checked) {
          checkedRows[rowNumber] = {};

          $cells.each(function(cellIndex) {
            if (cellIndex > 0 && cellIndex < 5) {
              // Update the row object with the key/cell combo
              checkedRows[rowNumber][keys[cellIndex]] = $(this).text();
            }
          });
          console.log(checkedRows[rowNumber]);
          ++rowNumber;
        }
      });

      // Convert checkedRows to JSON
      var updatedRooms = JSON.stringify( { "updatedRooms": checkedRows } );
      //alert(updatedRooms);

      // Send POST to /updaterooms and reload page when updates complete
      var xhr = new XMLHttpRequest();
      xhr.open("POST", "/updaterooms", true);
      xhr.setRequestHeader('Content-Type', 'application/json');
      xhr.onreadystatechange = function(e) {
        if (xhr.readyState === 4) {
          location.reload();
        }
      }
      xhr.send(JSON.stringify({
          value: updatedRooms
      }));
    }

  h4.divider _______________
  button.update.btn-primary(onclick='updaterooms()') Update Rooms